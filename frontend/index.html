<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSP Intelligence Mesh Network - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

        <style>
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }
        .loading-container p {
            margin-top: 1rem;
            color: var(--gray);
            font-size: 1.1rem;
        }
        </style>
    </head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand">
                <span>🌐</span>
                <span>MSP Intelligence Mesh</span>
            </a>
            <ul class="navbar-nav">
                <li><a href="index.html" class="nav-link active">Dashboard</a></li>
                <li class="dropdown">
                    <a class="nav-link dropdown-toggle">Agents ▼</a>
                    <div class="dropdown-menu">
                        <a href="threat-intelligence.html" class="dropdown-item">🛡️ Threat Intelligence</a>
                        <a href="market-intelligence.html" class="dropdown-item">💼 Market Intelligence</a>
                        <a href="nlp-query.html" class="dropdown-item">💬 NLP Query Assistant</a>
                        <a href="collaboration.html" class="dropdown-item">🤝 Collaboration Matching</a>
                        <a href="client-health.html" class="dropdown-item">📊 Client Health Prediction</a>
                        <a href="revenue-optimization.html" class="dropdown-item">💰 Revenue Optimization</a>
                        <a href="anomaly-detection.html" class="dropdown-item">🔍 Anomaly Detection</a>
                        <a href="security-compliance.html" class="dropdown-item">✅ Security Compliance</a>
                        <a href="resource-allocation.html" class="dropdown-item">📅 Resource Allocation</a>
                        <a href="federated-learning.html" class="dropdown-item">🌐 Federated Learning</a>
                    </div>
                </li>
                <li><a href="workflow-demo.html" class="nav-link">Multi-Agent Demo</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Welcome Section -->
        <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h1 style="margin-bottom: 0.5rem;">🚀 Welcome to MSP Intelligence Mesh Network</h1>
            <p style="opacity: 0.9; font-size: 1.1rem;">10 specialized AI agents working together in real-time.</p>
        </div>

        <!-- System Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-agents">-</div>
                <div class="stat-label">AI Agents</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="active-agents">-</div>
                <div class="stat-label">Active</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-health">-</div>
                <div class="stat-label">Average Health</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="response-time">-</div>
                <div class="stat-label">Avg Response</div>
            </div>
        </div>

        <!-- Agent Grid -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
                <span>🤖</span>
                <span>AI Agents Overview</span>
            </div>
            <div id="agents-grid" class="grid grid-3">
                <div style="text-align: center; padding: 2rem; grid-column: 1 / -1;">
                    <div class="loading loading-lg"></div>
                    <p style="margin-top: 1rem; color: var(--gray);">Loading agents...</p>
                </div>
            </div>
        </div>

        <!-- Live Activity Feed -->
        <div class="card">
            <div class="card-header">
                <span>📡</span>
                <span>Live Activity Feed</span>
            </div>
            <div class="card-body">
                <div id="activity-feed" class="activity-feed">
                    <div class="activity-item">
                        <div>System initialized successfully</div>
                        <div class="activity-time" id="init-time">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Multi-Agent Demo Section -->
        <div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
            <div class="card-header" style="color: white;">
                <span>🔄</span>
                <span>Multi-Agent Workflow Demo</span>
            </div>
            <div class="card-body" style="color: white;">
                <p style="margin-bottom: 1rem; opacity: 0.9;">See all 10 agents working together in a coordinated workflow. Watch threat detection, analysis, collaboration, and response in action!</p>
                <a href="workflow-demo.html" class="btn btn-primary" style="background: white; color: #f5576c;">
                    <span>🚀</span>
                    <span>Launch Full Demo</span>
                </a>
            </div>
        </div>

        <!-- System Metrics -->
        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <span>📊</span>
                <span>System Performance Metrics</span>
            </div>
            <div class="card-body">
                <div id="metrics-container">
                    <div class="result-item">
                        <span class="result-label">System Status</span>
                        <span class="result-value"><span class="badge badge-success">Operational</span></span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Models Loaded</span>
                        <span class="result-value" id="models-loaded">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Last Updated</span>
                        <span class="result-value" id="last-updated">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        async function loadAgentStatus() {
            const grid = document.getElementById('agents-grid');
            grid.innerHTML = '<div style="text-align: center; padding: 2rem; grid-column: 1 / -1;"><div class="loading loading-lg"></div><p style="margin-top: 1rem; color: var(--gray);">Loading agents...</p></div>';
            try {
                const data = await MSP.apiCall('/agents/status');
                // Expect backend format: { agents: { agent_type: { status, health_score, ... } }, total_agents, active_agents }
                const agentsObj = data.agents || {};
                const agentTypes = Object.keys(agentsObj);

                // Update stats
                document.getElementById('total-agents').textContent = data.total_agents ?? agentTypes.length;
                document.getElementById('active-agents').textContent = data.active_agents ?? agentTypes.length;
                const avg = agentTypes.length ? (agentTypes.map(k => agentsObj[k].health_score || 0).reduce((a,b)=>a+b,0) / agentTypes.length) : 0;
                document.getElementById('avg-health').textContent = `${Math.round(avg * 100)}%`;
                document.getElementById('response-time').textContent = '—';

                // Render cards
                grid.innerHTML = '';
                agentTypes.forEach((type) => {
                    const agentData = agentsObj[type];
                    grid.innerHTML += MSP.createAgentCard(type, agentData);
                });
            } catch (err) {
                console.error('Failed to load agents:', err);
                grid.innerHTML = '<div style="text-align:center; padding:2rem; grid-column:1 / -1;">❌ Failed to load agents. Ensure backend is running at http://localhost:8000</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadAgentStatus();
            setInterval(loadAgentStatus, 30000);
        });
    </script>
</body>
</html>
